name: Upload Video to YouTube (Manual)

on:
  workflow_dispatch:
    inputs:
      video_title:
        description: 'Video title'
        required: true
        type: string
      video_description:
        description: 'Video description'
        required: false
        type: string
        default: 'AI learning through evolution #Shorts'

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
    
    - name: Download latest video
      uses: actions/download-artifact@v3
      with:
        path: final_shorts/
    
    - name: Find video file
      id: find_video
      run: |
        VIDEO_FILE=$(find final_shorts/ -name "*.mp4" | head -1)
        echo "video_file=$VIDEO_FILE" >> $GITHUB_OUTPUT
    
    - name: Upload to YouTube
      if: steps.find_video.outputs.video_file != ''
      run: |
        python upload.py \
          --file "${{ steps.find_video.outputs.video_file }}" \
          --title "${{ inputs.video_title }}" \
          --description "${{ inputs.video_description }}" \
          --category "28" \
          --keywords "AI,machine learning,evolution,shorts" \
          --privacyStatus "public"
      env:
        YT_CLIENT_ID: ${{ secrets.YT_CLIENT_ID }}
        YT_CLIENT_SECRET: ${{ secrets.YT_CLIENT_SECRET }}
        YT_REFRESH_TOKEN: ${{ secrets.YT_REFRESH_TOKEN }}